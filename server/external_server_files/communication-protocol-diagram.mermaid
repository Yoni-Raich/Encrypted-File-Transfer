sequenceDiagram
    participant לקוח
    participant שרת

    Note over לקוח,שרת: רישום והחלפת מפתחות
    לקוח->>שרת: בקשת רישום (קוד 825)<br/>מזהה לקוח: 16 בתים | גרסה: 1 בית | קוד: 2 בתים (825) | גודל תוכן: 4 בתים | שם: 255 בתים
    שרת-->>לקוח: רישום הצליח (קוד 1600)<br/>גרסה: 1 בית | קוד: 2 בתים (1600) | גודל תוכן: 4 בתים | מזהה לקוח: 16 בתים
    לקוח->>שרת: שליחת מפתח ציבורי (קוד 826)<br/>מזהה לקוח: 16 בתים | גרסה: 1 בית | קוד: 2 בתים (826) | גודל תוכן: 4 בתים | שם: 255 בתים | מפתח ציבורי: 160 בתים
    שרת-->>לקוח: מפתח AES מוצפן (קוד 1602)<br/>גרסה: 1 בית | קוד: 2 בתים (1602) | גודל תוכן: 4 בתים | מזהה לקוח: 16 בתים | מפתח AES מוצפן: משתנה

    Note over לקוח,שרת: העברת קובץ
    לקוח->>שרת: שליחת קובץ (קוד 828)<br/>מזהה לקוח: 16 בתים | גרסה: 1 בית | קוד: 2 בתים (828) | גודל תוכן: 4 בתים | גודל תוכן: 4 בתים | גודל קובץ מקורי: 4 בתים | מספר חבילה: 4 בתים | שם קובץ: 255 בתים | תוכן: משתנה
    שרת-->>לקוח: קובץ התקבל עם CRC (קוד 1603)<br/>גרסה: 1 בית | קוד: 2 בתים (1603) | גודל תוכן: 4 בתים | מזהה לקוח: 16 בתים | גודל תוכן: 4 בתים | שם קובץ: 255 בתים | CRC: 4 בתים
    
    alt CRC תקין
        לקוח->>שרת: CRC תקין (קוד 900)<br/>מזהה לקוח: 16 בתים | גרסה: 1 בית | קוד: 2 בתים (900) | גודל תוכן: 4 בתים | שם קובץ: 255 בתים
        שרת-->>לקוח: אישור (קוד 1604)<br/>גרסה: 1 בית | קוד: 2 בתים (1604) | גודל תוכן: 4 בתים | מזהה לקוח: 16 בתים
    else CRC לא תקין (עד 3 פעמים)
        לקוח->>שרת: CRC לא תקין (קוד 901)<br/>מזהה לקוח: 16 בתים | גרסה: 1 בית | קוד: 2 בתים (901) | גודל תוכן: 4 בתים | שם קובץ: 255 בתים
        שרת-->>לקוח: אישור (קוד 1604)<br/>גרסה: 1 בית | קוד: 2 בתים (1604) | גודל תוכן: 4 בתים | מזהה לקוח: 16 בתים
        Note over לקוח,שרת: חזרה על העברת הקובץ
    else CRC לא תקין (פעם רביעית)
        לקוח->>שרת: CRC לא תקין, מוותר (קוד 902)<br/>מזהה לקוח: 16 בתים | גרסה: 1 בית | קוד: 2 בתים (902) | גודל תוכן: 4 בתים | שם קובץ: 255 בתים
        שרת-->>לקוח: אישור (קוד 1604)<br/>גרסה: 1 בית | קוד: 2 בתים (1604) | גודל תוכן: 4 בתים | מזהה לקוח: 16 בתים
    end

    Note over לקוח,שרת: התחברות מחדש
    לקוח->>שרת: בקשת התחברות מחדש (קוד 827)<br/>מזהה לקוח: 16 בתים | גרסה: 1 בית | קוד: 2 בתים (827) | גודל תוכן: 4 בתים | שם: 255 בתים
    alt התחברות מחדש הצליחה
        שרת-->>לקוח: מפתח AES מוצפן (קוד 1605)<br/>גרסה: 1 בית | קוד: 2 בתים (1605) | גודל תוכן: 4 בתים | מזהה לקוח: 16 בתים | מפתח AES מוצפן: משתנה
    else התחברות מחדש נכשלה
        שרת-->>לקוח: התחברות מחדש נדחתה (קוד 1606)<br/>גרסה: 1 בית | קוד: 2 בתים (1606) | גודל תוכן: 4 בתים | מזהה לקוח: 16 בתים
    end

    Note over שרת: שגיאת שרת
    שרת-->>לקוח: שגיאת שרת כללית (קוד 1607)<br/>גרסה: 1 בית | קוד: 2 בתים (1607) | גודל תוכן: 4 בתים | מזהה לקוח: 16 בתים
